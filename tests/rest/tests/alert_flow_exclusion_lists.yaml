input: test_01.pcap

localnet: 192.168.1.0/24

ignore:
  - date
  - duration

pre: |
  # Enable all user scripts
  curl -s -u admin:admin -H "Content-Type: application/json" -d '{"ifid": 0, "action": "enable"}' http://localhost:3333/lua/toggle_all_user_scripts.lua

  # Add some filters to test alert exclusion lists

  # Exclude a "Remote to Remote" generated by a Telegram flow [1 alert]
  # 149.154.167.91 Remote :443 [ 10:13:31:F1:39:76 ]   192.168.1.93 Remote :55156 [ 28:37:37:00:6D:C8 ]
  curl -s -u admin:admin -H "Content-Type: application/json" -d '{"filters":"srv_addr=192.168.1.93,srv_port=55156,l7_proto=185,proto=6","confset_id":"0","subdir":"flow","script_key":"remote_to_remote"}' http://localhost:3333/lua/rest/v1/edit/user_script/filter.lua

  # Exclude a Suspicious TCP SYN probing generated by an HTTP flow [1 alert]
  # 192.168.1.93 Remote :61692 [ 28:37:37:00:6D:C8 ]   2.23.155.233 Remote :80 [ 10:13:31:F1:39:76 ]
  curl -s -u admin:admin -H "Content-Type: application/json" -d '{"filters":"srv_addr=2.23.155.233,srv_port=80,l7_proto=7","confset_id":"0","subdir":"flow","script_key":"tcp_probing"}' http://localhost:3333/lua/rest/v1/edit/user_script/filter.lua

  # Exclude flow risk TLS (probably) not carrying HTTPS [1 alert]
  # 192.168.1.93 Remote :61685 [ 28:37:37:00:6D:C8 ]   185.54.150.85 Remote :443 [ 10:13:31:F1:39:76 ]
  curl -s -u admin:admin -H "Content-Type: application/json" -d '{"filters":"srv_addr=185.54.150.85,flow_risk_bitmap=32768","confset_id":"0","subdir":"flow","script_key":"flow_risks"}' http://localhost:3333/lua/rest/v1/edit/user_script/filter.lua

  # Exclude TLS Certificate Expired alerts on port 443 for 31.13.86.36 [3 alerts]
  curl -s -u admin:admin -H "Content-Type: application/json" -d '{"filters":"srv_addr=31.13.86.36,srv_port=443","confset_id":"0","subdir":"flow","script_key":"tls_certificate_expired"}' http://localhost:3333/lua/rest/v1/edit/user_script/filter.lua

  # Exclude TLS Certificate Expired alerts for 192.168.1.176 [29 alerts]
  curl -s -u admin:admin -H "Content-Type: application/json" -d '{"filters":"srv_addr=192.168.1.176","confset_id":"0","subdir":"flow","script_key":"tls_certificate_expired"}' http://localhost:3333/lua/rest/v1/edit/user_script/filter.lua

  # Exclude "Remote to Remote" alerts with info containing 'gigya.com'
  curl -s -u admin:admin -H "Content-Type: application/json" -d '{"filters":"info=gigya.com","confset_id":"0","subdir":"flow","script_key":"remote_to_remote"}' http://localhost:3333/lua/rest/v1/edit/user_script/filter.lua

  # Allow the changed configuration to be re-read
  sleep 5

post: |
  curl -s -u admin:admin  -H "Content-Type: application/json" -d '{"ifid": 0, "status": "historical-flows"}' http://localhost:3333/lua/rest/v1/get/alert/data.lua
